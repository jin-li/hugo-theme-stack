/// Params:
///     Resources: Where to search for images
///     Image: Image URL

/// Returns:
///     Local: true if the image is local, false if it is remote
///     Resource: Hugo image resource object, not nil if the image is local
///     Permalink: Image URL
///     Height: Image height
///     Width: Image width

/// Note: 
///     For remote images, to avoid getting stuck in downloading an image, 
///     we directly return the image URL without checking its validity. 
///     So for remote images, the returned Permalink may be invalid if the 
///     image URL is invalid. Please make sure the image URL is valid when 
///     using remote images.

{{ $result := dict
    "Local" false
    "Resource" nil
    "Permalink" nil
    "Height" nil
    "Width" nil
}}

{{ if .Image }}
    {{ $url := urls.Parse .Image }}
    {{ $resource := "" }}
    {{ if not (in (slice "https" "http") $url.Scheme) }}
        {{ $resource = .Resources.Get (printf "%s" (.Image | safeURL)) }}
    {{ else }}
        {{ $result = dict
            "Local" false
            "Resource" nil
            "Permalink" .Image
            "Height" nil
            "Width" nil
        }}
    {{ end }}

    {{ if $resource }}
        {{- $isSVG := eq $resource.MediaType.SubType "svg"  -}}
        {{- if $isSVG -}}
            {{ $result = dict
                "Local" true
                "Resource" $resource
                "Permalink" $resource.RelPermalink
                "Height" nil
                "Width" nil
            }}
        {{- else -}}
            {{- $result = dict
                "Local" true
                "Resource" $resource
                "Permalink" $resource.RelPermalink
                "Height" $resource.Height
                "Width" $resource.Width
            }}
        {{- end -}}
    {{ end }}
{{ end }}

{{ return $result }}